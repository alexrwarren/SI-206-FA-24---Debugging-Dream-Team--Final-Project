import re
import os
import json
import requests
import sqlite3

# get 120 paintings from API
def get_paintings():
    # set url
    url = "https://openaccess-api.clevelandart.org/api/artworks"
    
    # set parameters to search for
    # must search for only paintings and only created after 1800 (found in API documentation, varies by museum)
    params = {'type': 'Painting', 'created_after': 1860, 'limit': 125}
    
    # initializes empty list for paintings
    paintings = []
    
    # sends request to API, collects data for 120 paintings from API
    # return list of paintings
    response = requests.get(url, params=params)
    
    if response.status_code == 200:
        data = response.json()  
        paintings.extend(data['data'])
    else:
        return None
    
    return paintings

# write data to json file
def write_file(paintings):
    # set path for a json file, make name of museum
    file_path = 'Cleveland_cache.json'
    
    # open file in write mode
    file = open(file_path, "w")
    
    # dump json data into file, indent for readability
    json.dump(paintings, file, indent=4)
    
    # returns nothing
    return None

# read json data into list of dictionaries
def read_data_from_file(file_name):
    
    # set path for file, open and read file contents, load in and return json file data
    full_path = os.path.join(os.path.dirname(__file__), file_name)
    f = open(full_path)
    data = f.read()
    f.close()
    json_data = json.loads(data)
    return json_data

# set up the database
def set_up_database(database_name):
    # set path, create conn and cur and return them
    path = os.path.dirname(os.path.abspath(__file__))
    conn = sqlite3.connect(path + "/" + database_name)
    cur = conn.cursor()
    return cur, conn

# set up the Cleveland table
def create_Cleveland_table(paintings, cur, conn):
    # create table if it doesn't exist (change name of table depending on museum name)
    # includes id_key, title, creation_year, main_artist, gender (for Met)
    cur.execute("CREATE TABLE IF NOT EXISTS Cleveland (id_key INTEGER PRIMARY KEY, title TEXT UNIQUE, creation_year INTEGER, main_artist TEXT)")
    return None